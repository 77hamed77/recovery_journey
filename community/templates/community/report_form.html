{% extends 'base.html' %}
{% load static %}
{% load custom_filters %} {# قد تحتاج إلى هذا الفلتر لـ instance_of إذا لم يكن متاحًا عالميًا #}

{% block title %}الإبلاغ عن محتوى{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-surface rounded-3xl shadow-2xl p-6 md:p-8 my-8 animate-fade-in-up">
    <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-8" style="color: var(--color-danger);">
        <i class="fas fa-flag ml-3"></i> الإبلاغ عن محتوى
    </h1>
    <p class="text-lg text-center text-gray-700 mb-8">
        أنت على وشك الإبلاغ عن 
        {% comment %}
            فلتر instance_of غير مدمج في Django افتراضيًا. 
            إذا كنت تستخدمه، يجب أن يكون لديك تعريف له في ملف templatetags.
            وإلا، يمكنك تمرير نوع الكائن من View أو استخدام if obj.model_name == 'post'
        {% endcomment %}
        {% if content_object|instance_of:"Post" %} {# هذا يتطلب فلتر مخصص أو طريقة بديلة #}
            <span class="font-semibold text-primary-dark">منشور</span>
        {% elif content_object|instance_of:"Comment" %} {# هذا يتطلب فلتر مخصص أو طريقة بديلة #}
            <span class="font-semibold text-primary-dark">تعليق</span>
        {% else %}
            <span class="font-semibold text-primary-dark">محتوى</span>
        {% endif %}
        :
        "<span class="italic text-gray-800">{{ content_object.title|default:content_object.content|truncatechars:50 }}</span>".
        <br>
        الرجاء اختيار السبب وتقديم وصف إذا لزم الأمر.
    </p>

    <form method="post" class="space-y-6">
        {% csrf_token %}
        <input type="hidden" name="content_type_id" value="{{ content_type_id }}">
        <input type="hidden" name="object_id" value="{{ object_id }}">

        <div>
            <label for="{{ form.reason.id_for_label }}" class="block text-lg font-semibold text-gray-700 mb-2">سبب البلاغ</label>
            {{ form.reason }}
            {% if form.reason.errors %}
                <p class="text-red-500 text-sm mt-1">{{ form.reason.errors|join:", " }}</p>
            {% endif %}
        </div>

        <div>
            <label for="{{ form.description.id_for_label }}" class="block text-lg font-semibold text-gray-700 mb-2">وصف إضافي (اختياري)</label>
            {{ form.description }}
            {% if form.description.errors %}
                <p class="text-red-500 text-sm mt-1">{{ form.description.errors|join:", " }}</p>
            {% endif %}
        </div>

        <div class="text-center mt-8">
            <button type="submit" class="inline-flex items-center justify-center
                           bg-danger text-white font-bold py-3 px-8 rounded-full shadow-md
                           hover:bg-red-700 hover:scale-105 transition duration-300 ease-in-out
                           focus:outline-none focus:ring-4 focus:ring-red-300 focus:ring-opacity-75">
                <i class="fas fa-flag ml-2"></i> إرسال البلاغ
            </button>
            <a href="{{ content_object.get_absolute_url }}" class="inline-flex items-center justify-center
                       bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-full shadow-md ml-4 rtl:ml-0 rtl:mr-4
                       hover:bg-gray-300 hover:scale-105 transition duration-300 ease-in-out
                       focus:outline-none focus:ring-4 focus:ring-gray-400 focus:ring-opacity-75">
                <i class="fas fa-arrow-left ml-2"></i> إلغاء
            </a>
        </div>
    </form>
</div>
{% endblock %}
