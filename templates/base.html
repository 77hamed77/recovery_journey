{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ{% endblock %}</title>

    <!-- =================================================================== -->
    <!--                       Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„ØªÙØ§Ø¹Ù„                       -->
    <!-- =================================================================== -->
    <!-- Tailwind CSS (Ø§Ù„Ø£Ø³Ø§Ø³) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js (Ù„Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø®ÙÙŠÙØ©) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- HTMX (Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©) -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Google Fonts: Cairo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

    <!-- =================================================================== -->
    <!--               Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ÙˆØ§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©              -->
    <!-- =================================================================== -->
     
    <!-- GSAP (Ù„Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù…Ø«Ù„ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <!-- Swiper.js (Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- Canvas Confetti (Ù„Ù„Ø§Ø­ØªÙØ§Ù„Ø§Øª) -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <!-- lottie -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

    <!-- =================================================================== -->
    <!--                             Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ…ÙŠÙ…                            -->
    <!-- =================================================================== -->
    <style>
      :root {
        --color-bg: #F5F7FA;          /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø£Ø¨ÙŠØ¶ Ù…Ø§Ø¦Ù„ Ù„Ù„Ø±Ù…Ø§Ø¯ÙŠ) */
        --color-surface: #FFFFFF;     /* Ø§Ù„Ø£Ø³Ø·Ø­ Ø§Ù„Ù…Ø±ØªÙØ¹Ø© Ù…Ø«Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        --color-primary: #A8D5BA;      /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø£Ø®Ø¶Ø± Ø¨Ø§Ø³ØªÙŠÙ„ÙŠ) */
        --color-secondary: #B3CDE0;    /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ (Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ) */
        --color-accent: #F7C6A3;       /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„ØªØ­ÙÙŠØ²ÙŠ (Ø®ÙˆØ®ÙŠ) */
        --color-text-primary: #2D3748; /* Ù†Øµ Ø±Ø¦ÙŠØ³ÙŠ (Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ†) */
        --color-text-secondary: #718096;/* Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ (Ø±Ù…Ø§Ø¯ÙŠ Ø¨Ø§Ù‡Øª) */
        --color-border: #E2E8F0;       /* Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„Ø­ÙˆØ§Ù */
      }

      /* Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© Ù‡Ø§Ø¯Ø¦Ø© ÙˆÙ…ØªØ­Ø±ÙƒØ© */
      body {
        font-family: 'Cairo', sans-serif;
        background: linear-gradient(-45deg, #eef3f7, #dde7f0, #f7e9dd, #dceee4);
        background-size: 400% 400%;
        animation: gradientBG 20s ease infinite;
        color: var(--color-text-primary);
      }

      @keyframes gradientBG {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
      }
      
      /* Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± HTMX Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
      .htmx-indicator{ display:none; }
      .htmx-request .htmx-indicator{ display:inline-block; }
    </style>
</head>
<body class="antialiased">

    <!-- Ø­Ø§ÙˆÙŠØ© Ù„Ø¬Ø²ÙŠØ¦Ø§Øª particles.js (ØªÙˆØ¶Ø¹ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©) -->
    <div id="particles-container" class="fixed top-0 left-0 w-full h-full z-[-1]"></div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯ ÙˆØ£Ù†ÙŠÙ‚ -->
    <nav class="bg-surface/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="/" class="text-2xl font-bold tracking-wider" style="color: var(--color-text-primary);">Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ</a>
                <div class="flex items-center space-x-4 md:space-x-6">
                    {% if user.is_authenticated %}
                        <a href="{% url 'dashboard' %}" class="font-medium transition hover:scale-105" style="color: var(--color-text-secondary);--hover-color: var(--color-text-primary);" onmouseover="this.style.color=this.style.getPropertyValue('--hover-color')" onmouseout="this.style.color='var(--color-text-secondary)'">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                        <a href="{% url 'chatbot' %}" class="font-medium transition hover:scale-105" style="color: var(--color-text-secondary);--hover-color: var(--color-text-primary);" onmouseover="this.style.color=this.style.getPropertyValue('--hover-color')" onmouseout="this.style.color='var(--color-text-secondary)'">Ø±ÙÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¨</a>
                        <form action="{% url 'logout' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="font-medium transition hover:scale-105" style="color: var(--color-text-secondary);--hover-color: var(--color-text-primary);" onmouseover="this.style.color=this.style.getPropertyValue('--hover-color')" onmouseout="this.style.color='var(--color-text-secondary)'">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                        </form>
                    {% else %}
                        <a href="{% url 'register' %}" class="font-medium transition hover:scale-105" style="color: var(--color-text-secondary);--hover-color: var(--color-text-primary);" onmouseover="this.style.color=this.style.getPropertyValue('--hover-color')" onmouseout="this.style.color='var(--color-text-secondary)'">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
                        <a href="{% url 'login' %}" class="text-white font-bold px-4 py-2 rounded-lg transition-all duration-200 ease-in-out hover:scale-105 hover:shadow-lg active:scale-95" style="background-color: var(--color-primary);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                        <a href="{% url 'settings' %}" class="font-medium transition hover:scale-105" style="color: var(--color-text-secondary);--hover-color: var(--color-text-primary);" onmouseover="this.style.color=this.style.getPropertyValue('--hover-color')" onmouseout="this.style.color='var(--color-text-secondary)'">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            {% block content %}{% endblock %}
        </div>
    </main>

    {% block footer %}{% endblock %}

    <!-- =================================================================== -->
    <!--                    Ø³ÙƒØ±Ø¨ØªØ§Øª Ù…Ø®ØµØµØ© ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª                     -->
    <!-- =================================================================== -->
    
    <!-- ØªÙ‡ÙŠØ¦Ø© Particles.js -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="{% static 'js/particles-config.js' %}"></script> <!-- ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù -->
    
    <!-- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù† ÙŠØ¹Ù…Ù„ Ø¥Ù„Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª (Ù…Ø«Ù„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) -->
    <!-- Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø­Ø¯ÙˆØ« Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ -->
    {% if all_achievements_data_json %}
        {{ all_achievements_data_json|json_script:"achievements-data" }}
        <script>
            document.body.addEventListener('achievementsUnlocked', function(evt) {
                const achievements = evt.detail.achievementsUnlocked;
                const allData = JSON.parse(document.getElementById('achievements-data').textContent);
                const confettiTypes = allData.confetti_types;
                const sounds = allData.sounds;

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ø­Ø¯Ø§Ù‹ ØªÙ„Ùˆ Ø§Ù„Ø¢Ø®Ø± Ø¨ØªØ£Ø®ÙŠØ±
                achievements.forEach((ach, index) => {
                    setTimeout(() => {
                        // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¨Ø³ÙŠØ· Ø¨Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ø£Ø¬Ù…Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ SweetAlert2
                        alert(`ğŸ‰ Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯! ğŸ‰\n\n${ach.title}\n${ach.message}`);

                        // Ø¥Ø·Ù„Ø§Ù‚ Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ù€ Confetti Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
                        const confettiConfig = confettiTypes[ach.confetti_type];
                        if (confettiConfig) {
                            confetti(confettiConfig);
                        }

                        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                        const soundPath = sounds[ach.sound];
                        if (soundPath) {
                            new Audio(soundPath).play().catch(e => console.error("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e));
                        }

                    }, index * 4000); // ØªØ£Ø®ÙŠØ± 4 Ø«ÙˆØ§Ù†Ù Ø¨ÙŠÙ† ÙƒÙ„ Ø¥Ù†Ø¬Ø§Ø²
                });
            });
        </script>
    {% endif %}

</body>
</html>